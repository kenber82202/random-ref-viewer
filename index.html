<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Random Image Navigator</title>
<style>
  body {
    margin: 0; padding: 0;
    background: #000;
    color: #fff;
    font-family: sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    overflow: hidden;
  }
  img {
    max-width: 90vw;
    max-height: 90vh;
    border: 3px solid #fff;
    border-radius: 8px;
  }
  button {
    position: fixed;
    bottom: 20px;
    font-size: 3em;
    padding: 0.1em 0.3em;
    cursor: pointer;
    border-radius: 5px;
    border: none;
    background: rgba(30,30,30,0.8);
    color: #fff;
    user-select: none;
    transition: background 0.3s;
    z-index: 1000;
  }
  button:disabled {
    opacity: 0.3;
    cursor: default;
  }
  button:hover:not(:disabled) {
    background: rgba(70,70,70,0.9);
  }
  #backBtn {
    left: 20px;
  }
  #forwardBtn {
    right: 20px;
  }
</style>
</head>
<body>

<img id="mainImage" src="" alt="Random Image" />
<button id="backBtn" disabled aria-label="Previous image">&lt;</button>
<button id="forwardBtn" disabled aria-label="Next image">&gt;</button>

<script>
  let links = [];
  let currentIndex = 0;
  let historyStack = []; // previous 3 indices
  let forwardStack = []; // next 3 indices (preloaded)
  const maxHistory = 3;
  const maxPreload = 3;

  const imgElement = document.getElementById('mainImage');
  const backBtn = document.getElementById('backBtn');
  const forwardBtn = document.getElementById('forwardBtn');

  function preloadImage(url) {
    const img = new Image();
    img.src = url;
  }

  function updateButtons() {
    backBtn.disabled = historyStack.length === 0;
    forwardBtn.disabled = (currentIndex >= links.length - 1);
  }

  function showImage(index) {
    currentIndex = index;
    imgElement.src = links[currentIndex];
    imgElement.alt = `Image ${currentIndex + 1} of ${links.length}`;
    updateButtons();

    for(let i = currentIndex + 1; i <= currentIndex + maxPreload && i < links.length; i++) {
      preloadImage(links[i]);
    }
  }

  backBtn.addEventListener('click', () => {
    if (historyStack.length > 0) {
      forwardStack.unshift(currentIndex);
      if (forwardStack.length > maxPreload) forwardStack.pop();

      const prevIndex = historyStack.pop();
      showImage(prevIndex);
    }
  });

  forwardBtn.addEventListener('click', () => {
    if (currentIndex < links.length - 1) {
      historyStack.push(currentIndex);
      if (historyStack.length > maxHistory) historyStack.shift();

      let nextIndex;
      if (forwardStack.length > 0) {
        nextIndex = forwardStack.shift();
      } else {
        nextIndex = currentIndex + 1;
      }

      showImage(nextIndex);
    }
  });

  fetch('links.txt')
    .then(response => response.text())
    .then(text => {
      links = text.trim().split('\n').filter(Boolean);
      if (links.length === 0) {
        imgElement.alt = "No images found in links.txt";
        forwardBtn.disabled = true;
        backBtn.disabled = true;
        return;
      }
      currentIndex = Math.floor(Math.random() * links.length);
      showImage(currentIndex);
    })
    .catch(err => {
      imgElement.alt = "Failed to load links.txt";
      console.error(err);
    });
</script>

</body>
</html>
